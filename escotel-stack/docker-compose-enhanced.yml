version: '3.8'

# РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
# ­Ъџђ Mangwale Next-Gen Voice Stack - Enhanced Edition
# December 2025 - GPU-Optimized for RTX 3060 12GB
# РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
#
# Features:
#   - Multi-model TTS (Chatterbox-Turbo, Indic-Parler, CosyVoice3, Kokoro)
#   - Optimized ASR (Whisper-large-v3-turbo + AI4Bharat)
#   - WebRTC Voice Gateway with Silero VAD
#   - Exotel SIP Integration
#   - Real-time streaming throughout
#
# GPU Memory Budget (~8GB of 12GB):
#   - Whisper-turbo: ~2GB
#   - Chatterbox-Turbo: ~1.5GB
#   - Indic-Parler: ~2GB
#   - Overhead: ~1GB
#   - Headroom: ~5.5GB for LLM/future
# РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ

x-gpu-resources: &gpu-resources
  deploy:
    resources:
      reservations:
        devices:
          - driver: nvidia
            count: 1
            capabilities: [gpu]

x-common-env: &common-env
  environment:
    - TZ=Asia/Kolkata
    - PYTHONUNBUFFERED=1

services:
  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  # ­Ъј» VOICE GATEWAY - Main Entry Point
  # WebRTC, SIP, WebSocket, VAD, Turn-Taking, Session Management
  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  voice-gateway:
    build:
      context: ./voice-gateway
      dockerfile: Dockerfile
    container_name: mangwale-voice-gateway
    ports:
      - "8080:8080"        # HTTP API
      - "8081:8081"        # WebSocket
      - "5060:5060/udp"    # SIP (Exotel)
      - "10000-10100:10000-10100/udp"  # RTP media
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      # Service URLs
      - ASR_SERVICE_URL=http://asr:7001
      - TTS_SERVICE_URL=http://tts:7002
      - ORCHESTRATOR_URL=http://orchestrator:7000
      
      # Jupiter Brain
      - JUPITER_URL=http://192.168.0.156:3200
      - JUPITER_LLM_URL=http://192.168.0.156:8002
      
      # Exotel Configuration
      - EXOTEL_SID=${EXOTEL_SID}
      - EXOTEL_API_KEY=${EXOTEL_API_KEY}
      - EXOTEL_API_TOKEN=${EXOTEL_API_TOKEN}
      - EXOTEL_CALLER_ID=${EXOTEL_CALLER_ID:-02048556923}
      - EXOTEL_CALLBACK_URL=${EXOTEL_CALLBACK_URL:-https://exotel.mangwale.ai}
      
      # WebRTC Configuration
      - WEBRTC_ICE_SERVERS=${WEBRTC_ICE_SERVERS:-stun:stun.l.google.com:19302}
      - WEBRTC_ENABLE_TURN=${WEBRTC_ENABLE_TURN:-false}
      
      # VAD Configuration
      - VAD_MODEL=silero
      - VAD_THRESHOLD=0.5
      - VAD_MIN_SPEECH_DURATION=0.25
      - VAD_MIN_SILENCE_DURATION=0.5
      
      # Session Configuration
      - MAX_CONCURRENT_SESSIONS=10
      - SESSION_TIMEOUT_SECONDS=300
      - ENABLE_RECORDING=${ENABLE_RECORDING:-true}
      
      # Debug
      - DEBUG_MODE=${DEBUG_MODE:-false}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    volumes:
      - ./logs/gateway:/app/logs
      - ./recordings:/app/recordings
    networks:
      - mangwale-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  # ­Ъјц ASR SERVICE - Enhanced Speech-to-Text
  # Whisper-large-v3-turbo (Primary) + AI4Bharat Indic (Specialist)
  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  asr:
    build:
      context: ./asr-enhanced
      dockerfile: Dockerfile
    container_name: mangwale-asr-enhanced
    ports:
      - "7001:7001"
    <<: *gpu-resources
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - CUDA_VISIBLE_DEVICES=0
      
      # Primary ASR Model
      - ASR_MODEL=large-v3-turbo
      - ASR_MODEL_PATH=/app/models/whisper-large-v3-turbo
      - ASR_DEVICE=cuda
      - ASR_COMPUTE_TYPE=int8_float16
      - ASR_BEAM_SIZE=5
      - ASR_BEST_OF=5
      
      # Language Configuration
      - ASR_LANGUAGE=auto
      - ASR_SUPPORTED_LANGUAGES=hi,en,mr
      - ASR_DEFAULT_LANGUAGE=hi
      
      # Streaming Configuration
      - ASR_STREAMING_ENABLED=true
      - ASR_CHUNK_SIZE_MS=100
      - ASR_VAD_FILTER=true
      
      # Indic Specialist Model (enabled for better Hindi/Marathi)
      - INDIC_ASR_ENABLED=true
      - INDIC_ASR_MODEL=ai4bharat/indicconformer_stt_hi_hybrid_rnnt_large
      
      # Cloud Fallback
      - DEEPGRAM_API_KEY=${DEEPGRAM_API_KEY}
      - ENABLE_CLOUD_FALLBACK=${ENABLE_CLOUD_FALLBACK:-true}
      - CLOUD_FALLBACK_TIMEOUT_MS=5000
      
      # Performance
      - MAX_CONCURRENT_TRANSCRIPTIONS=4
      - BATCH_SIZE=1
      - GPU_MEMORY_FRACTION=0.25
    volumes:
      - ./models/whisper:/app/models
      - ./logs/asr:/app/logs
      - whisper_cache:/root/.cache/huggingface
    networks:
      - mangwale-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7001/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  # ­Ъћі TTS SERVICE - Multi-Model Text-to-Speech
  # Chatterbox-Turbo (EN) + Indic-Parler (HI/MR) + CosyVoice3 + Kokoro
  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  tts:
    build:
      context: ./tts-enhanced
      dockerfile: Dockerfile
    container_name: mangwale-tts-enhanced
    ports:
      - "7002:7002"
    <<: *gpu-resources
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - CUDA_VISIBLE_DEVICES=0
      
      # HuggingFace Authentication
      - HF_TOKEN=${HUGGINGFACE_API_KEY}
      - HUGGINGFACE_TOKEN=${HUGGINGFACE_API_KEY}
      - HF_HOME=/app/.cache/huggingface
      
      # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
      # PRIMARY MODELS (Always Loaded)
      # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
      
      # Chatterbox-Turbo - English (Primary)
      - CHATTERBOX_ENABLED=true
      - CHATTERBOX_MODEL=ResembleAI/chatterbox-turbo
      - CHATTERBOX_DEVICE=cuda
      
      # Indic-Parler-TTS - Hindi/Marathi (Primary)
      - INDIC_PARLER_ENABLED=true
      - INDIC_PARLER_MODEL=ai4bharat/indic-parler-tts
      - INDIC_PARLER_DEVICE=cuda
      - INDIC_SPEAKER_HINDI=${INDIC_SPEAKER_HINDI:-Rohit}
      - INDIC_SPEAKER_MARATHI=${INDIC_SPEAKER_MARATHI:-Sanjay}
      
      # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
      # SECONDARY MODELS (Load on Demand)
      # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
      
      # CosyVoice3 - Streaming Multilingual
      - COSYVOICE_ENABLED=${COSYVOICE_ENABLED:-false}
      - COSYVOICE_MODEL=FunAudioLLM/Fun-CosyVoice3-0.5B-2512
      - COSYVOICE_STREAMING=true
      
      # Kokoro-82M - Ultra-fast English Backup
      - KOKORO_ENABLED=${KOKORO_ENABLED:-true}
      - KOKORO_MODEL=hexgrad/Kokoro-82M
      - KOKORO_DEVICE=cuda
      
      # VibeVoice-Realtime - Streaming English
      - VIBEVOICE_ENABLED=${VIBEVOICE_ENABLED:-false}
      - VIBEVOICE_MODEL=microsoft/VibeVoice-Realtime-0.5B
      
      # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
      # LANGUAGE ROUTING
      # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
      - TTS_ROUTING_ENGLISH=chatterbox
      - TTS_ROUTING_HINDI=indic-parler
      - TTS_ROUTING_MARATHI=indic-parler
      - TTS_ROUTING_MULTILINGUAL=cosyvoice
      - TTS_FALLBACK_PROVIDER=elevenlabs
      
      # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
      # FEATURES
      # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
      
      # Streaming
      - TTS_STREAMING_ENABLED=true
      - TTS_CHUNK_SIZE_MS=100
      - TTS_BUFFER_SIZE_CHUNKS=3
      
      # Audio Quality
      - TTS_SAMPLE_RATE=24000
      - TTS_AUDIO_FORMAT=pcm_f32le
      
      # Emotion Tags (Chatterbox)
      - ENABLE_PARALINGUISTIC_TAGS=true
      
      # Voice Cloning
      - ENABLE_VOICE_CLONING=${ENABLE_VOICE_CLONING:-false}
      - VOICE_CLONING_MIN_AUDIO_SECONDS=5
      
      # Cloud Fallback
      - ELEVENLABS_API_KEY=${ELEVENLABS_API_KEY}
      - DEEPGRAM_API_KEY=${DEEPGRAM_API_KEY}
      - ENABLE_CLOUD_FALLBACK=${ENABLE_CLOUD_FALLBACK:-true}
      
      # Performance
      - GPU_MEMORY_FRACTION=0.35
      - MAX_CONCURRENT_SYNTHESIS=4
    volumes:
      - ./models:/app/models
      - ./logs/tts:/app/logs
      - hf_cache:/app/.cache/huggingface
      - ./voice-profiles:/app/voice-profiles
    networks:
      - mangwale-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7002/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  # ­ЪДа ORCHESTRATOR - Voice Flow Controller
  # Connects to Jupiter for LLM, manages conversation state
  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  orchestrator:
    build:
      context: ./orchestrator-enhanced
      dockerfile: Dockerfile
    container_name: mangwale-orchestrator-enhanced
    ports:
      - "7000:7000"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      # Internal Services
      - ASR_SERVICE_URL=http://asr:7001
      - TTS_SERVICE_URL=http://tts:7002
      - GATEWAY_URL=http://voice-gateway:8080
      
      # Jupiter Brain - All LLM/NLU
      - JUPITER_URL=http://192.168.0.156:3200
      - JUPITER_LLM_URL=http://192.168.0.156:8002
      - JUPITER_NLU_URL=http://192.168.0.156:7010
      
      # LLM Configuration
      - LLM_PROVIDER=jupiter
      - LLM_MODEL=Qwen/Qwen2.5-7B-Instruct-AWQ
      - LLM_STREAMING_ENABLED=true
      - LLM_MAX_TOKENS=512
      - LLM_TEMPERATURE=0.7
      
      # Conversation Management
      - CONVERSATION_TIMEOUT_SECONDS=300
      - MAX_CONVERSATION_TURNS=50
      - ENABLE_CONTEXT_MEMORY=true
      - CONTEXT_WINDOW_SIZE=10
      
      # Function Calling
      - ENABLE_FUNCTION_CALLING=true
      - FUNCTIONS_CONFIG_PATH=/app/config/functions.json
      
      # Cloud Fallback
      - GROQ_API_KEY=${GROQ_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - LLM_FALLBACK_PROVIDER=groq
      
      # Debug
      - DEBUG_MODE=${DEBUG_MODE:-false}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    volumes:
      - ./logs/orchestrator:/app/logs
      - ./config:/app/config
    depends_on:
      - asr
      - tts
    networks:
      - mangwale-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  # ­ЪјЏ№ИЈ ADMIN DASHBOARD - Monitoring & Management
  # Real-time call monitoring, model switching, metrics
  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  admin:
    build:
      context: ./admin-dashboard
      dockerfile: Dockerfile
    container_name: mangwale-admin-dashboard
    ports:
      - "8000:8000"
    environment:
      # Service URLs
      - GATEWAY_URL=http://voice-gateway:8080
      - ASR_URL=http://asr:7001
      - TTS_URL=http://tts:7002
      - ORCHESTRATOR_URL=http://orchestrator:7000
      
      # Jupiter
      - JUPITER_URL=http://192.168.0.156:3200
      
      # Authentication
      - ADMIN_USERNAME=${ADMIN_USERNAME:-admin}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-mangwale123}
      - JWT_SECRET=${JWT_SECRET:-your-secret-key}
      
      # Features
      - ENABLE_CALL_RECORDING_PLAYBACK=true
      - ENABLE_LIVE_METRICS=true
      - ENABLE_MODEL_SWITCHING=true
      - ENABLE_VOICE_TESTING=true
    volumes:
      - ./logs:/app/logs:ro
      - ./recordings:/app/recordings:ro
    networks:
      - mangwale-network
    restart: unless-stopped

  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  # ­ЪЊі METRICS - Prometheus + Grafana (Optional)
  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  prometheus:
    image: prom/prometheus:latest
    container_name: mangwale-prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./config/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
    networks:
      - mangwale-network
    restart: unless-stopped
    profiles:
      - monitoring

  grafana:
    image: grafana/grafana:latest
    container_name: mangwale-grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD:-admin}
    volumes:
      - grafana_data:/var/lib/grafana
      - ./config/grafana/dashboards:/etc/grafana/provisioning/dashboards
    networks:
      - mangwale-network
    restart: unless-stopped
    profiles:
      - monitoring

  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  # ­Ъїљ WEB UI - Test Interface
  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  web-ui:
    image: nginx:alpine
    container_name: mangwale-web-ui
    ports:
      - "8888:80"
    volumes:
      - ./web-ui:/usr/share/nginx/html:ro
      - ./config/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - mangwale-network
    restart: unless-stopped

  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  # ­ЪЌё№ИЈ REDIS - Session State & Caching
  # РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
  redis:
    image: redis:7-alpine
    container_name: mangwale-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes
    networks:
      - mangwale-network
    restart: unless-stopped

# РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
# NETWORKS
# РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
networks:
  mangwale-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/16

# РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
# VOLUMES
# РЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљ
volumes:
  hf_cache:
    name: mangwale_hf_cache
  whisper_cache:
    name: mangwale_whisper_cache
  redis_data:
    name: mangwale_redis_data
  prometheus_data:
    name: mangwale_prometheus_data
  grafana_data:
    name: mangwale_grafana_data
